/*
Copyright Â© 2021 Nikita Ivanovski info@slnt-opp.xyz

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
syntax = "proto3";
package nocloud.services;

option go_package = "github.com/slntopp/nocloud/pkg/services/proto";

import "google/protobuf/struct.proto";
import "pkg/instances/proto/instances.proto";

message Service {
    string version = 1;
    string title = 2;
    map<string, google.protobuf.Value> context = 3;
    map<string, nocloud.instances.InstancesGroup> instances_groups = 4;
    string state = 5;
}

message ValidateServiceConfigRequest {
    Service config = 1;
    string namespace = 2;
}

message ValidateServiceConfigError {
    string error = 1; 
    string instance_group = 2;
    string instance = 3;
}

message ValidateServiceConfigResponse {
    bool result = 1;
    repeated ValidateServiceConfigError errors = 2; 
}

message CreateServiceRequest {
    Service service = 1;
    string namespace = 2;
}

message CreateServiceResponse {
    string id = 1;
}

message UpdateServiceRequest {
    string id = 1;
    string namespace = 2;
    Service service = 3;
}

message UpdateServiceResponse {
    bool result = 1;
}

message DeleteServiceRequest {
    string id = 1;
}

message DeleteServiceResponse {
    bool result = 1;
}

message PerformServiceActionRequest {
    string id = 1;
    string action = 2;
    map<string, google.protobuf.Value> data = 3; 
}

message PerformServiceActionResponse {
    bool result = 1;
    map<string, google.protobuf.Value> meta = 2; 
}

service ServicesService {
    rpc ValidateServiceConfig(nocloud.services.ValidateServiceConfigRequest) returns (nocloud.services.ValidateServiceConfigResponse);
    rpc CreateService(nocloud.services.CreateServiceRequest) returns (nocloud.services.CreateServiceResponse);
    rpc UpdateService(nocloud.services.UpdateServiceRequest) returns (nocloud.services.UpdateServiceResponse);
    rpc DeleteService(nocloud.services.DeleteServiceRequest) returns (nocloud.services.DeleteServiceResponse);
    rpc PerformServiceAction(nocloud.services.PerformServiceActionRequest) returns (nocloud.services.PerformServiceActionResponse);
}